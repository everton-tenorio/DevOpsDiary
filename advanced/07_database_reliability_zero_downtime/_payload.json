[{"data":1,"prerenderedAt":511},["ShallowReactive",2],{"advanced-07_database_reliability_zero_downtime":3},{"id":4,"title":5,"body":6,"description":496,"extension":497,"meta":498,"navigation":499,"path":500,"seo":501,"stem":502,"tags":503,"__hash__":510},"advanced/advanced/07_database_reliability_zero_downtime.md","Database Reliability & Zero-Downtime Operations",{"type":7,"value":8,"toc":485},"minimark",[9,14,33,37,41,326,331,342,346,369,373,378,403,408,424,429,479,482],[10,11,13],"h2",{"id":12},"learning-objectives","Learning Objectives",[15,16,17,21,24,27,30],"ul",{},[18,19,20],"li",{},"Implement database high availability with replication and automatic failover",[18,22,23],{},"Design and execute zero-downtime schema migrations",[18,25,26],{},"Build and validate backup and recovery procedures with defined RTO and RPO",[18,28,29],{},"Monitor database performance and implement proactive capacity management",[18,31,32],{},"Operate stateful workloads on Kubernetes with production-grade reliability",[10,34,36],{"id":35},"requirements","Requirements",[38,39,40],"p",{},"You are required to operate a production-grade database on your platform with full reliability practices:",[42,43,44,109,161,227,277],"ol",{},[18,45,46,50],{},[47,48,49],"strong",{},"High Availability Setup",[15,51,52,75,92],{},[18,53,54,55],{},"Deploy PostgreSQL with high availability using one of:\n",[15,56,57,63,69],{},[18,58,59,62],{},[47,60,61],{},"CloudNative-PG operator"," (recommended for Kubernetes)",[18,64,65,68],{},[47,66,67],{},"Patroni"," with etcd for leader election",[18,70,71,74],{},[47,72,73],{},"AWS RDS Multi-AZ"," or equivalent managed service",[18,76,77,78],{},"Configure:\n",[15,79,80,83,86,89],{},[18,81,82],{},"Primary + 2 replicas minimum",[18,84,85],{},"Automatic failover: primary failure must trigger promotion in \u003C 30 seconds",[18,87,88],{},"Synchronous replication for at least one replica (zero data loss on failover)",[18,90,91],{},"Read replicas for read-heavy queries",[18,93,94,95],{},"Test failover:\n",[15,96,97,100,103,106],{},[18,98,99],{},"Kill the primary Pod or instance",[18,101,102],{},"Measure time to automatic promotion",[18,104,105],{},"Verify application continues serving requests during failover",[18,107,108],{},"Document RTO achieved vs. target",[18,110,111,114],{},[47,112,113],{},"Backup and Recovery",[15,115,116,130,141],{},[18,117,118,119],{},"Implement a multi-layer backup strategy:\n",[15,120,121,124,127],{},[18,122,123],{},"Continuous WAL archiving to object storage (S3/GCS) - point-in-time recovery",[18,125,126],{},"Daily full backups with Velero or pg_basebackup",[18,128,129],{},"Weekly backup to a different region or cloud provider",[18,131,132,133],{},"Define and document:\n",[15,134,135,138],{},[18,136,137],{},"RPO target: maximum acceptable data loss (e.g., 5 minutes)",[18,139,140],{},"RTO target: maximum acceptable recovery time (e.g., 30 minutes)",[18,142,143,144],{},"Execute a full disaster recovery drill:\n",[15,145,146,149,152,155,158],{},[18,147,148],{},"Delete the entire database cluster and all local backups",[18,150,151],{},"Restore from backup to a target point in time",[18,153,154],{},"Verify data integrity after restore",[18,156,157],{},"Measure actual RPO and RTO achieved vs. targets",[18,159,160],{},"Document every command used - this becomes the DR runbook",[18,162,163,166],{},[47,164,165],{},"Zero-Downtime Schema Migrations",[15,167,168,191,194,213],{},[18,169,170,171],{},"Implement a migration strategy using the expand-contract pattern:\n",[15,172,173,179,185],{},[18,174,175,178],{},[47,176,177],{},"Expand",": add new columns/tables as nullable, deploy new code that writes to both old and new schema",[18,180,181,184],{},[47,182,183],{},"Migrate",": backfill existing data in batches (never migrate millions of rows in one transaction)",[18,186,187,190],{},[47,188,189],{},"Contract",": remove old columns/tables only after verifying no code reads them",[18,192,193],{},"Use a migration tool: Flyway, Liquibase, or Alembic",[18,195,196,197],{},"Demonstrate three types of zero-downtime migrations:\n",[15,198,199,202,205],{},[18,200,201],{},"Adding a nullable column to a large table",[18,203,204],{},"Renaming a column (expand-contract with a view as bridge)",[18,206,207,208,212],{},"Adding an index on a large table (",[209,210,211],"code",{},"CREATE INDEX CONCURRENTLY",")",[18,214,215,216],{},"Integrate migrations into the CI/CD pipeline:\n",[15,217,218,221,224],{},[18,219,220],{},"Migrations run automatically before deployment",[18,222,223],{},"Failed migrations halt the deployment",[18,225,226],{},"Rollback is automated for failed migrations",[18,228,229,232],{},[47,230,231],{},"Database Observability",[15,233,234,237,260],{},[18,235,236],{},"Deploy the PostgreSQL Prometheus exporter",[18,238,239,240],{},"Create a Grafana dashboard tracking:\n",[15,241,242,245,248,251,254,257],{},[18,243,244],{},"Connection pool utilization (PgBouncer or application pool)",[18,246,247],{},"Query latency: p50, p95, p99",[18,249,250],{},"Cache hit ratio (target > 99%)",[18,252,253],{},"Replication lag (alert if > 10 seconds)",[18,255,256],{},"Lock wait events",[18,258,259],{},"Bloat on tables and indexes",[18,261,262,263],{},"Configure alerts for:\n",[15,264,265,268,271,274],{},[18,266,267],{},"Connection pool > 80% utilized",[18,269,270],{},"Replication lag > 30 seconds",[18,272,273],{},"Long-running queries > 5 minutes",[18,275,276],{},"Disk usage > 70%",[18,278,279,282],{},[47,280,281],{},"Connection Management and Performance",[15,283,284,287,298,301,323],{},[18,285,286],{},"Deploy PgBouncer as a connection pooler in front of PostgreSQL",[18,288,289,290,293,294,297],{},"Configure pooling mode: ",[209,291,292],{},"transaction"," for most services, ",[209,295,296],{},"session"," where required",[18,299,300],{},"Demonstrate the impact: compare application latency with and without the pool",[18,302,303,304,307,308],{},"Identify and optimize the top 3 slowest queries using ",[209,305,306],{},"pg_stat_statements",":\n",[15,309,310,317,320],{},[18,311,312,313,316],{},"Use ",[209,314,315],{},"EXPLAIN ANALYZE"," to understand query plans",[18,318,319],{},"Add appropriate indexes",[18,321,322],{},"Rewrite inefficient queries if needed",[18,324,325],{},"Document query optimization process and performance improvement measured",[327,328,330],"h3",{"id":329},"stretch-goals","Stretch Goals",[15,332,333,336,339],{},[18,334,335],{},"Implement logical replication between PostgreSQL versions for zero-downtime major version upgrades",[18,337,338],{},"Configure pglogical for selective table replication to a read analytics replica",[18,340,341],{},"Implement database chaos: inject network partitions between primary and replica and verify behavior",[327,343,345],{"id":344},"deliverables","Deliverables",[15,347,348,351,354,357,360,363],{},[18,349,350],{},"HA PostgreSQL deployment with automatic failover demonstrated and timed",[18,352,353],{},"Backup configuration with WAL archiving and a completed DR drill with RPO/RTO measurements",[18,355,356],{},"Three zero-downtime migration examples with CI/CD integration",[18,358,359],{},"Grafana database dashboard with all required metrics",[18,361,362],{},"PgBouncer configuration with before/after performance comparison",[18,364,365,366,368],{},"Query optimization report with ",[209,367,315],{}," output and improvement measurements",[327,370,372],{"id":371},"references","References",[38,374,375],{},[47,376,377],{},"Books",[15,379,380,389,396],{},[18,381,382],{},[383,384,388],"a",{"href":385,"rel":386},"https://www.oreilly.com/library/view/database-reliability-engineering/9781491925935/",[387],"nofollow","Database Reliability Engineering - Laine Campbell & Charity Majors",[18,390,391],{},[383,392,395],{"href":393,"rel":394},"https://www.oreilly.com/library/view/postgresql-up-and/9781492057659/",[387],"PostgreSQL: Up and Running - Regina Obe & Leo Hsu",[18,397,398],{},[383,399,402],{"href":400,"rel":401},"https://pragprog.com/titles/aapg/high-performance-postgresql-for-rails/",[387],"High Performance PostgreSQL for Rails - Andrew Atkinson",[38,404,405],{},[47,406,407],{},"Courses",[15,409,410,417],{},[18,411,412],{},[383,413,416],{"href":414,"rel":415},"https://roadmap.sh/postgresql-dba",[387],"PostgreSQL DBA - roadmap.sh",[18,418,419],{},[383,420,423],{"href":421,"rel":422},"https://www.percona.com/training",[387],"Percona University - PostgreSQL Performance",[38,425,426],{},[47,427,428],{},"Tools and Documentation",[15,430,431,438,445,452,459,466,472],{},[18,432,433],{},[383,434,437],{"href":435,"rel":436},"https://cloudnative-pg.io/documentation/",[387],"CloudNative-PG Operator",[18,439,440],{},[383,441,444],{"href":442,"rel":443},"https://patroni.readthedocs.io/",[387],"Patroni - HA PostgreSQL",[18,446,447],{},[383,448,451],{"href":449,"rel":450},"https://fldocs.flyway.com/",[387],"Flyway Database Migrations",[18,453,454],{},[383,455,458],{"href":456,"rel":457},"https://www.pgbouncer.org/config.html",[387],"PgBouncer Documentation",[18,460,461],{},[383,462,465],{"href":463,"rel":464},"https://github.com/prometheus-community/postgres_exporter",[387],"postgres_exporter",[18,467,468],{},[383,469,306],{"href":470,"rel":471},"https://www.postgresql.org/docs/current/pgstatstatements.html",[387],[18,473,474],{},[383,475,478],{"href":476,"rel":477},"https://www.prisma.io/dataguide/types/relational/expand-and-contract-pattern",[387],"Expand-Contract Pattern",[480,481],"hr",{},[38,483,484],{},"Once you complete this task you will operate databases the way companies that cannot afford data loss operate them - with defined recovery targets, zero-downtime change processes, and visibility into every aspect of database behavior.",{"title":486,"searchDepth":487,"depth":487,"links":488},"",2,[489,490],{"id":12,"depth":487,"text":13},{"id":35,"depth":487,"text":36,"children":491},[492,494,495],{"id":329,"depth":493,"text":330},3,{"id":344,"depth":493,"text":345},{"id":371,"depth":493,"text":372},"Implement database high availability, backup strategies, zero-downtime migrations, and operational reliability practices","md",{},true,"/advanced/07_database_reliability_zero_downtime",{"title":5,"description":496},"advanced/07_database_reliability_zero_downtime",[504,505,506,507,508,509],"advanced","database","reliability","postgresql","zero-downtime","devops","EG2-DTuaRxxuoRvt2lf1w10l4vP6XZl_4AjMr_NqDS4",1772317995194]